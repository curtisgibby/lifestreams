function calculateEventDuration(t,e){let a=e.getFullYear()-t.getFullYear(),n=e.getMonth()-t.getMonth(),r=e.getDate()-t.getDate();r<0&&(n-=1,r+=new Date(e.getFullYear(),e.getMonth(),0).getDate()),n<0&&(a-=1,n+=12);let s="";return a>0&&(s+=a>1?`${a} years, `:`${a} year, `),n>0&&(s+=n>1?`${n} months, `:`${n} month, `),r>0&&(s+=r>1?`${r} days`:`${r} day`),s=s.replace(/,\s*$/,""),s.trim()}const streamMargin=5,streamHeight=50,svgWidth=window.innerWidth-50,height=(streams.length+1)*(streamHeight+streamMargin),svg=d3.select("#svg1").attr("width",svgWidth).attr("height",height).style("background-color","#eee"),locale=navigator.languages?navigator.languages[0]:navigator.language||navigator.userLanguage||"en",minimumEventWidthDays=3,now=new Date,epochStart=new Date("1970-01-01");let startDate=now,endDate=epochStart;for(const t of streams)for(const e of t.events)e.parsedStartDate=e.startDate?new Date(e.startDate):epochStart,e.parsedStartDate<startDate&&(startDate=e.parsedStartDate),e.parsedEndDate=e.endDate?new Date(e.endDate):now,e.parsedEndDate>endDate&&(endDate=e.parsedEndDate),e.duration=calculateEventDuration(e.parsedStartDate,e.parsedEndDate),e.endDate==e.startDate&&e.parsedEndDate.setDate(e.parsedEndDate.getDate()+minimumEventWidthDays);const timeScale=d3.scaleTime().domain([new Date(startDate),new Date(endDate)]).range([0,svgWidth]),xAxis=d3.axisBottom().scale(timeScale);svg.append("g").call(xAxis);const tooltip=d3.select("body").append("div").style("position","absolute").style("z-index","10").style("visibility","hidden").style("padding",".1rem").style("background","#dddddddd");for(const t of streams){const e=t.index*(streamHeight+streamMargin);for(const a of t.events){let n="";t.label&&(n+="<h4>"+t.label+"</h4>"),a.label&&(n+="<h5>"+a.label+"</h5>"),(a.startDate||a.endDate)&&(n+="<p><i>",a.startDate&&(n+=a.parsedStartDate.toLocaleDateString(locale,{timeZone:"UTC"})),a.endDate!=a.startDate&&(n+="â€“"),a.endDate&&a.endDate!=a.startDate&&(n+=a.parsedEndDate.toLocaleDateString(locale,{timeZone:"UTC"})),""!=a.duration&&(n+="<br>("+a.duration+")"),n+="</i></p>"),a.imageUrl&&(n+='<img style="max-width: 200px; max-height: 200px;" src="'+a.imageUrl+'">'),svg.append("line").style("stroke",a.color||t.color).style("stroke-width",streamHeight).attr("x1",timeScale(new Date(a.parsedStartDate))).attr("y1",e).attr("x2",timeScale(new Date(a.parsedEndDate))).attr("y2",e).attr("data-html",n).on("mouseover",function(t){window.t&&(clearTimeout(window.t),window.t=void 0),tooltip.html(t.target.getAttribute("data-html")).style("visibility","visible").style("left",t.clientX+10+"px").style("top",t.clientY-28+"px")}).on("mouseout",function(t){window.t=setTimeout(function(){tooltip.style("visibility","hidden")},500)})}}